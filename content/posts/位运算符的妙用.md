+++
title = "位运算符的妙用"
description = "description"
keywords = ["位运算"]
categories = ["位运算"]
tags = ["位运算"]
date = 2019-06-17T16:11:23+08:00
draft = true
# CJKLanguage: Chinese, Japanese, Korean
isCJKLanguage = true
# 排序你的文章
weight = 40

# 这里还可以自定义任何参数，这些参数可以在模板中使用
toc = true
comments = false
# 精选图片
featured_image = ""
+++

> 介绍位运算的使用和技巧  
<!--more-->

### 位左移`<<`
运算符规则是：各二进位全部左移若干位，高位丢弃，低位补0。

- 左移常被用来做 * (2 ^ n)的运算，因为直接基于二进制运算，所以左移效率比 * (2 ^ n)高。
```bash
# 6 << 2 = 24
0000 0000 0000 0000 0000 0000 0000 0110     -> 6
0000 0000 0000 0000 0000 0000 0001 1000     -> 6 << 2 = 24
```

### 位右移`>>`
运算符规则是：各二进位全部右移若干位，正数高位补0，负数高位补1，低位丢弃。

- 右移常被用来做 / (2 ^ n)的运算，因为直接基于二进制运算，所以右移效率比 / (2 ^ n)高。
```bash
# -12 >> 2 = -3
1111 1111 1111 1111 1111 1111 1111 0100    -> -12
1111 1111 1111 1111 1111 1111 1111 1101    -> -12 >> 2 = -3
```

- 取绝对值
```bash
#  a >> 31 == 0 ? a : (~a + 1)
```

### 无符号位右移`>>>`
运算符规则是：各二进位全部右移若干位，高位补0，低位丢弃。

```bash
# 12 >>> 2 = 3
0000 0000 0000 0000 0000 0000 0000 1100     -> 12
0000 0000 0000 0000 0000 0000 0000 0011     -> 12 >>> 2 = 3
# -12 >>> 2 = 1073741821
1111 1111 1111 1111 1111 1111 1111 0100    -> -12
0011 1111 1111 1111 1111 1111 1111 1101    -> -12 >> 2 = 1073741821
```

### 位与运算符`&`
运算符规则是：当运算符两边相同位置都是1时，结果返回1，其他情况都返回0。

```bash
# 3 & 5
0000 0000 0000 0000 0000 0000 0000 0011     -> 3
0000 0000 0000 0000 0000 0000 0000 0101     -> 5
0000 0000 0000 0000 0000 0000 0000 0001     -> 3 & 5 = 1
```

- 判断奇偶数
```bash
# 用if ((a & 1) == 0) 代替 if (a % 2 == 0)来判断a是不是偶数。
0000 0000 0000 0000 0000 0000 0000 0011     -> 3
0000 0000 0000 0000 0000 0000 0000 0001     -> 1
0000 0000 0000 0000 0000 0000 0000 0001     -> 1
```

- 取余
```bash
# 我们要让a对16进行取余，那么就可以让 a & 15 得出来的结果就是余数。
0000 0000 0000 0000 0000 0000 0000 1111     -> 15
# a & 15 返回值就是a二进制的最低四位，也就是 a & 15 = a / 16。
```
使用此方法取余，只能对于2^n的数值进行取余计算。但是在JDK源码中也是经常被使用到，比如说HashMap中判断key在Hash桶中的位置。

### 位或运算符`|`
运算符规则是：当运算符两边相同位置都是0时，结果返回0，其他情况都返回1。
```bash
# 3 | 5 = 7
0000 0000 0000 0000 0000 0000 0000 0011     -> 3
0000 0000 0000 0000 0000 0000 0000 0101     -> 5
0000 0000 0000 0000 0000 0000 0000 0111     -> 3 | 5 = 7
```
- 生成第一个大于a的满足2^n的数
HashMap的构造器支持传入一个初始的hash桶size，所以HashMap需要对用户传入的size进行处理，生成一个第一个大于size的并且满足2^n的数。
HashMap#tableSizeFor

### 位非运算符`~`
运算符规则是：将运算符后二进制数反转，0变1，1变0。
```bash
# ~ 3 = -4
0000 0000 0000 0000 0000 0000 0000 0011     -> 3
1111 1111 1111 1111 1111 1111 1111 1100     -> ~ 3 = -4
```

- 求相反数： 
```bash
# ~a + 1
```

### 位异或运算符`^`
运算符规则是：当运算符两边相同位置都是相同，结果返回0，不相同时返回1。
```bash
# 3 ^ 5 = 6
0000 0000 0000 0000 0000 0000 0000 0011     -> 3
0000 0000 0000 0000 0000 0000 0000 0101     -> 5
0000 0000 0000 0000 0000 0000 0000 0110     -> 3 ^ 5 = 6
```

- 使某些特定的位翻转
```bash
# 例如对数10100001的第2位和第3位翻转
       10100001
     ^ 00000110
     ----------
       10100111
```
- 实现两个值的交换，而不必使用临时变量
```bash
# 交换两个整数a=10100001，b=00000110的值
     a = a^b; //a=10100111
     b = b^a; //b=10100001
     a = b^a; //a=00000110
```
- 在汇编语言中经常用于将变量置零
```bash
$ xor a,a 即 a=a^a
```
- 快速判断两个值是否相等
```bash
$ return ((a ^ b) == 0)
```

### 相关文档
---
- [位运算符^ 按位异或的妙用](https://peirenlei.iteye.com/blog/1767306)


